#!/bin/bash

service=$1
script=$2

help() {
    echo "script [service] [script]"
    echo
    echo To execute a script on a service the service must be running.
    echo These are the services and scripts that can be run:

    find ./scripts -maxdepth 1 -mindepth 1 -type d | sort | while read script_dir; do
        echo
        echo $(basename $script_dir)

        find $script_dir -maxdepth 1 -mindepth 1 -type f | sort | while read script_file; do
            echo "  - $(basename $script_file)"
        done
    done
}

run_script() {
    script_path="./scripts/$service/$script"

    if [ ! -f $script_path ]; then
        echo "Could not find the '$script' script for the '$service' service."
        exit 1
    fi

    # Excute the script
    $script_path

    handle_container_error
}

handle_container_error() {
    result=$?
    if [ $result -ne 0 ]
    then
        echo
        echo "Hint: If you're told the 'container is not running' you'll need to start it first:"
        echo
        echo "    % docker-compose up -d website"
        exit $result
    fi
}

case "$service" in
"" | "--help" | "-h")
    help
    ;;
*)
    run_script
    ;;
esac
